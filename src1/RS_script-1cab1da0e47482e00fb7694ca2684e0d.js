jQuery(document).ready(function($){init();var JDATA={};var submit_open=!1;function init(){$('body').on('click','.evoRS_status_option_selection span',function(){show_rsvp_form($(this),$(this).attr('data-val'),'submit')})}
function load_json_to_local(O){JDATA=O.closest('.evo_metarow_rsvp').find('.evors_jdata').data('j')}
$('body').on('click','span.evors_choices',function(){OBJ=$(this);VAL=OBJ.attr('data-val');SUBMISSION_FORM=OBJ.closest('form.evors_submission_form');SUBMISSION_FORM.attr('class','evors_submission_form  rsvp_'+VAL);OBJ.siblings().removeClass('set');OBJ.addClass('set');OBJ.siblings('input').val(VAL)});$('body').on('click','.evors_incard_close',function(){PAR=$(this).parent();PAR.slideUp(function(){PAR.html('')});$(this).closest('.evo_metarow_rsvp').find('.evors_choices').removeClass('set')});$('body').on('click','.evors_checkbox_field',function(){O=$(this);if(O.hasClass('checked')){O.removeClass('checked');O.siblings('input').val('no')}else{O.addClass('checked');O.siblings('input').val('yes')}});$('body').on('click','.evors_eventtop_rsvp span',function(event){event.preventDefault();event.stopPropagation();load_json_to_local($(this));var obj=$(this),rsvp=obj.parent(),rsvp_section=rsvp.parent(),ajaxdataa={};ajaxdataa.rsvp=obj.data('val');ajaxdataa.lang=rsvp.data('lang');ajaxdataa.uid=rsvp.data('uid');ajaxdataa.updates='no';ajaxdataa.action='the_ajax_evors_a7';ajaxdataa.repeat_interval=rsvp.data('ri');ajaxdataa.e_id=rsvp.data('eid');$.ajax({beforeSend:function(){rsvp.addClass('loading')},type:'POST',url:evors_ajax_script.ajaxurl,data:ajaxdataa,dataType:'json',success:function(data){if(data.status=='0'){$('body').trigger('evors_new_rsvp_eventtop');rsvp.html(data.message).addClass('success');rsvp_section.find('.evors_eventtop_section_data').replaceWith(data.content)}else{rsvp.append('<span class="error">'+data.message+'</span>')}},complete:function(){rsvp.removeClass('loading')}})});$('body').on('click','.evors_submit_rsvpform_btn',function(){var obj=O=$(this),ajaxdataa={},form=obj.closest('form.evors_submission_form'),FORMPAR=form.parent(),formSection=form.parent(),error=0,formType=form.find('input[name="formtype"]').val();rsvp_hide_notifications();FORMPAR.parent().removeClass('error');form.find('.input').each(function(index){iO=$(this);$(this).removeClass('err');if(iO.hasClass('req')&&iO.hasClass('checkbox')&&iO.val()=='no'){error=1;iO.siblings('em').addClass('err')}
if(iO.hasClass('req')&&iO.val()==''&&iO.is(":visible")){error=1;iO.addClass('err')}
if($(this).val()=='')return!0});if(error==0){var thisemail=form.find('input[name=email]');if(!is_email(thisemail.val().trim())){thisemail.addClass('err');rsvp_error('err2','','',form);error=2}}
if(error==0){if(formType=='update'){pastVal=parseInt(form.find('input[name=count]').attr('data-pastval'));newVal=parseInt(form.find('input[name=count]').val());compareCount=(pastVal>newVal)?0:newVal-pastVal}else{compareCount=parseInt(form.find('input[name=count]').val())}
if(form.find('.rsvp_status span.set').data('val')!='n'&&JDATA.cap&&JDATA.cap!='na'&&compareCount>parseInt(JDATA.cap)){error=4;form.find('input[name=count]').addClass('err');rsvp_error('err9','','',form)}
if(JDATA.precap!='na'&&(parseInt(form.find('input[name=count]').val())>parseInt(JDATA.precap))){error=4;form.find('input[name=count]').addClass('err');rsvp_error('err10','','',form)}}
if(error==0){var human=rsvp_validate_human(form.find('input.captcha'));if(!human){error=3;rsvp_error('err6','','',form)}}
if(formType=='wl-remove')error=0;if(error==0){var updates=form.find('.updates input').attr('checked');updates=(updates=='checked')?'yes':'no';ajaxdataa.action='the_ajax_evors';form.ajaxSubmit({beforeSend:function(){form.parent().addClass('loading')},type:'POST',url:evors_ajax_script.ajaxurl,data:ajaxdataa,dataType:'json',success:function(data){form.parent().removeClass('loading');form.parent().addClass('afterloading');$(".afterloading").append("<div class='afterloading_message'>Ваша заявка отправлена! В ближайшее время мы свяжемся с Вами!</div>");if(data.status=='0'){FORMPAR.parent().html(data.message);EVENTCARD=$('body').find('.event_'+data.e_id+'_'+data.ri);lb_eventcard=$('body').find('.evo_lightbox_body.event_'+data.e_id+'_'+data.ri);if('data_content_eventtop' in data){if(lb_eventcard.find('.evors_eventtop_section_data').length>0){lb_eventcard.find('.evors_eventtop_section_data').replaceWith(data.data_content_eventtop)}
if(EVENTCARD.find('.evors_eventtop_section_data').length>0){EVENTCARD.find('.evors_eventtop_section_data').replaceWith(data.data_content_eventtop)}}
if('data_content_eventtop_your' in data){if(lb_eventcard.find('.evors_eventop_rsvped_data').length>0){lb_eventcard.find('.evors_eventop_rsvped_data').replaceWith(data.data_content_eventtop_your)}
if(EVENTCARD.find('.evors_eventop_rsvped_data').length>0){EVENTCARD.find('.evors_eventop_rsvped_data').replaceWith(data.data_content_eventtop_your)}}
if(data.e_id){if(data.data_content_eventcard!=''){EVENTCARD.find('.evors_eventcard_content').html(data.data_content_eventcard);lb_eventcard.find('.evors_eventcard_content').html(data.data_content_eventcard)}}
if($('body').find('#rsvp_event_'+data.e_id).length>0&&data.new_rsvp_text){STATUS=$('#rsvp_event_'+data.e_id).find('span.rsvpstatus');STATUS.html(data.new_rsvp_text);STATUS.attr('class','rsvpstatus status_'+data.new_rsvp_text)}}else{var passedRsvppd=(data.status)?'err'+data.status:'err7';rsvp_error(passedRsvppd,'',data.message,form)}},complete:function(){form.parent().removeClass('loading')}})}else if(error==1){rsvp_error('err','','',form)}});$('body').on('change','input.evors_rsvp_count',function(){O=$(this);$('.evors_lightbox_body').removeClass('error');$(this).removeClass('err');rsvp_hide_notifications();CAP=JDATA.cap;PERCAP=JDATA.precap;FORM=O.closest('.evors_submission_form');VAL=parseInt(O.val());ERROR=!1;if(VAL>parseInt(CAP)&&CAP!='na'){$(this).addClass('err');rsvp_error('err9','','',FORM);ERROR=!0}
if(VAL>parseInt(PERCAP)&&PERCAP!='na'){$(this).addClass('err');rsvp_error('err10','','',FORM);ERROR=!0}
if(!ERROR){guestNames=O.closest('.evors_submission_form').find('.form_guest_names');if(VAL>1){maskField='<input class="regular input" name="names[]" type="text">';inputHolder=guestNames.find('.form_guest_names_list');ExistInputCount=inputHolder.find('input').length;if((VAL-1)>ExistInputCount){fieldsNeed=VAL-1-ExistInputCount;appender='';for(x=0;x<fieldsNeed;x++){appender+=maskField}
inputHolder.append(appender)}else{fieldsNeed=VAL-2;inputHolder.find('input').each(function(index){if(index>fieldsNeed)$(this).remove()})}
guestNames.show()}else{guestNames.hide()}}});$("body").on('click','.evors_change_rsvp_trig',function(){OBJ=$(this);PAR=OBJ.parent();show_rsvp_form(OBJ,'','update')});$('body').on('click','#call_change_rsvp_form',function(){OBJ=$(this);PAR=OBJ.parent();show_rsvp_form(OBJ,'','update')});$('.eventon_rsvp_rsvplist').on('click','.update_rsvp',function(){OBJ=$(this);PAR=OBJ.parent();JDATA=OBJ.parent().siblings('.evors_jdata').data('j');console.log(JDATA);show_rsvp_form(OBJ,'','update')});function show_rsvp_form(OBJ,RSVP,formtype){var ajaxdataa={};ajaxdataa.action='evors_get_rsvp_form';ROW=OBJ.closest('.evo_metarow_rsvp');if(OBJ.closest('.evo_metarow_rsvp').length)load_json_to_local(OBJ);if(JDATA){$.each(JDATA,function(index,val){ajaxdataa[index]=val})}
ajaxdataa.rsvp=RSVP;ajaxdataa.formtype=formtype;FORMNEST=OBJ.closest('.evors_forms').parent();$.ajax({beforeSend:function(){loading(OBJ)},url:evors_ajax_script.ajaxurl,data:ajaxdataa,dataType:'json',type:'POST',success:function(data){if(data.status=='good'){if(ajaxdataa.incard=='yes'){ROW.find('.evors_incard_form').removeClass('error').html(data.content).slideDown()}else{$('.evors_lightbox').find('.evo_lightbox_body').removeClass('error').html(data.content);$('.evors_lightbox.evo_lightbox').addClass('show');$('body').trigger('evolightbox_show')}}else{}},complete:function(){completeloading(OBJ);FORMNEST.closest('.evorow').removeClass('loading')}})}
function loading(obj){obj.closest('.evorow').addClass('loading');obj.closest('p.rsvpmanager_event').addClass('loading')}
function completeloading(obj){obj.closest('.evorow').removeClass('loading');obj.closest('p.rsvpmanager_event').removeClass('loading')}
$('body').on('click','.evors_findrsvp_form_btn',function(){var obj=$(this);var form=obj.closest('form.evors_findrsvp_form');FORM_PAR=form.closest('.evors_forms');var error=0;form.find('.input').each(function(index){if($(this).hasClass('req')&&$(this).val()==''){error=1}});if(error=='1'){rsvp_error('err','','',form)}else{var ajaxdataa={};ajaxdataa.action='evors_find_rsvp_form';form.ajaxSubmit({beforeSend:function(){FORM_PAR.addClass('loading')},url:evors_ajax_script.ajaxurl,data:ajaxdataa,dataType:'json',type:'POST',success:function(data){if(data.status=='good'){FORM_PAR.parent().html(data.content);FORM_PAR.parent().removeClass('error')}else{rsvp_error('err5','','',form)}},complete:function(){FORM_PAR.removeClass('loading')}})}});$('body').on('mouseover','.evors_whos_coming span.initials',function(){OBJ=$(this);EM=OBJ.parent().find('em.tooltip');TEXT=OBJ.data('name');POS=OBJ.position();EM.css({'left':(POS.left+20),'top':(POS.top-30)}).html(TEXT).show()});$('body').on('mouseout','.evors_whos_coming span',function(){OBJ=$(this);EM=OBJ.parent().find('em.tooltip');EM.hide()});$('body').on('click','.evors_whos_coming span',function(){LINK=$(this).data('link');if(LINK!='na')
window.open(LINK,'_blank')});$('#evoau_event_manager').on('click','a.load_rsvp_stats',function(event){event.preventDefault();O=$(this);MANAGER=$(this).closest('.evoau_manager');var data_arg={action:'evors_ajax_get_auem_stats',eid:O.data('eid'),data:O.closest('.evoau_manager').find('.evoau_manager_json').data('js')};$.ajax({beforeSend:function(){MANAGER.find('.eventon_actionuser_eventslist').addClass('evoloading')},type:'POST',url:evors_ajax_script.ajaxurl,data:data_arg,dataType:'json',success:function(data){$('body').trigger('evoau_show_eventdata',[MANAGER,data.html,!0])},complete:function(){MANAGER.find('.eventon_actionuser_eventslist').removeClass('evoloading')}})});$('.evoau_manager_event').on('click','span.checkin',function(){var obj=$(this);var PAR=obj.closest('.evorsau_attendee_list');if(!PAR.hasClass('checkable'))return!1;var status=obj.attr('data-status');status=(status==''||status=='check-in')?'checked':'check-in';var data_arg={action:'the_ajax_evors_f4',rsvp_id:obj.attr('data-id'),status:status,nonce:PAR.find('input#evors_nonce').val()};$.ajax({beforeSend:function(){obj.html(obj.html()+'...')},type:'POST',url:evors_ajax_script.ajaxurl,data:data_arg,dataType:'json',success:function(data){obj.attr({'data-status':status}).html(data.new_status_lang).removeAttr('class').addClass(status+' checkin')}})});$('body').on('click','.evorsw_remove_wl',function(){FORM=$(this).closest('form');FORM.find('input[name="formtype"]').val('wl-remove');FORM.find('.evors_submit_rsvpform_btn').trigger('click')});function rsvp_error(code,type,message,O){FORM=O.closest('.evors_forms');F=FORM.find('form');if(message==''||message===undefined){var C=FORM.find('.evors_msg_').data('j');var classN=(type==undefined||type=='error'||type=='')?'err':type;message=C.codes[code]}
FORM.find('.notification').addClass(classN).show().find('p').html(message);FORM.parent().addClass('error');F.addClass('error')}
function rsvp_hide_notifications(){$('.evors_lightbox_body').find('.notification').hide()}
function rsvp_validate_human(field){if(field==undefined){return!0}else{var numbers=['11','3','6','3','8'];if(numbers[field.attr('data-cal')]==field.val()){return!0}else{return!1}}}
function is_email(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}})